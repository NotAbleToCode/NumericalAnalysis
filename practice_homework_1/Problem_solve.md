# 前言
采用了numpy，matplotlib库进行函数图像的展示。  
相关API这里不再介绍。  
关于插值，python的scipy库的interploate模块集成了多种插值，可以调用来验证自己实现的插值函数精确度。
# Problem1
## 1.Lagrange插值和Hermite插值
### Lagrange插值
可使用待定系数法，基函数法，牛顿法。由于其基函数的形式十分简单，故采用基函数的方法求解。对一组给定的插值点和需要代入计算的x，计算出每个基函数取x的值，乘以x点的函数值，再相加即可。用两层循环很容易实现。  
### Hermite插值
Hermite插值较为麻烦，因为其不仅要求在每个插值点函数值相等，还要求导数值相等。求解也有三种方法，待定系数法，基函数法，牛顿法。其基函数形式随着点的增多而变得复杂，公式如下：
![avatar](../images/Hermite1.png)
![avatar](../images/Hermite2.png)  
比较复杂的是计算li(x)的导数，好在有规律可寻，可以用程序实现。
## 2.切比雪夫多项式零点的Lagrange插值
利用等距节点进行插值，往往会出现龙格现象，但利用切比雪夫零点进行插值，利用其余项的形式，以及切比雪夫多项式的性质（一个n次的首项系数是n的切比雪夫多项式，其是区间上所有次数小于等于n的首项系数为1的最大值最小的多项式），可知用切比雪夫的零点进行插值可使误差限最小。而且会一致收敛。  
切比雪夫多项式：Tn(x) = cos(n*arccos(x))，-1 <= x <= 1  
易知零点为：x = cos((2k + 1)/(2n) * π) , k = 0,1,2...,n-1  
一般区间可以经变换到[-1, 1]区间来求零点。
## 3.分段线性插值和分段三次Hermite插值
### 分段线性插值
对每个输入的x，判断其所在区间，然后在该区间用两点的拉格朗日插值很容易写出算式并计算出x的插值函数值。  
### 分段三次Hermite插值
对每个输入的x，判断其所在区间，然后在该区间用两点三次的Hermite插值计算x的插值函数值。由于两点三次的Hermite插值的基函数形式的推导和形式也不复杂，故采用基函数很容易写出算式并计算出插值函数值。
## 4.三次样条插值
三次样条插值，要求满足插值点函数值相等，插值点函数连续，一阶导连续，二阶导连续。注意这时候导数不一定等于原函数的导数值。  
设插值函数为S(x)。  
可以用类似两点三次的埃尔米特插值方法来求三次样条插值。  
也可以先假设插值函数的二阶导数值的形式（用拉格朗日插值写出），这样便满足二阶导数连续。然后求两次积分，并利用插值条件消去S(xj)和S'(xj)，得到的表达式满足插值条件，函数值连续，二阶导连续。然后再利用一阶导数连续，加上边界条件，即可求解。  
一般，若附加条件是边界点的一阶导数值，则最后得到的线性方程组的系数矩阵是三对角形式，而且该三对角阵满足顺序主子式不等于0，对角线元素是该列最大的元素，因此可利用高斯消元法求解，无误差放大效应。  
求解公式如下：  
![avatar](../images/three_spline_interpolation1.png)
![avatar](../images/three_spline_interpolation2.png)
![avatar](../images/three_spline_interpolation3.png)
![avatar](../images/three_spline_interpolation4.png)  
# Problem2
## 1.复合梯形公式
梯形公式和辛普森公式都是等距分布的插值型求积公式的特例。其中梯形公式为插值点是两个的情况，辛普森公式是插值点为三个的情况。等距分布的插值型求积公式，设共有$x_0,x_1...,x_n$共n+1个插值点，那么当n为奇数时，其有n阶代数精度，当n为偶数时，其有n+1阶代数精度。  
梯形公式：S = (b - a)/2 * (f(a) + f(b))，具有一阶代数精度。  
辛普森公式：S = (b - a)/6 * (f(a) + 4*f((a+b)/2) + f(b))具有三阶代数精度。  
然后对区间进行划分，每个小区间应用公式，再累加即可。
## 2.复合辛普森公式
见复合梯形公式。
## 3.复合两点高斯公式
对于一般的机械求积公式：   
$\int_a^bf(x)\rho(x)dx$ = $\sum_{k=0}^nA_kf(x_k)$  
其有2n+2个未知参数，因此我们希望如果可以恰当选择$x_k$，使该机械求积公式达到2n+1的代数精度。这些点称为高斯点。  
一般思路是，待定2n+2个未知参数，然后对$f(x)=1,f(x)=x,f(x)=x^2...f(x)=x^{2n+1}$的情况列出2n+2个方程求解。但是该方法求解起来很困难。  
有更简单的结论来求高斯点：  
在[a, b]上带权$\rho(x)$的n+1次正交多项式的零点就是求积公式$\int_a^bf(x)\rho(x)dx$的高斯点，有了高斯点，便可代入$\sum_{k=0}^nA_kf(x_k)$中，然后对$f(x)=1,f(x)=x,f(x)=x^2...f(x)=x^n$的情况列出n+1个方程求解$A_i,i=0,1,...n-1,n$即可。  
有一些现有的带权$\rho(x)$的高斯点可以查表得到，对于带权$\rho(x)=1$，积分区间为$[-1,1]$的高斯点，查表如下：  
两点求积：高斯点-0.5773503和0.5773503，系数为1,1  
三点求积：高斯点-0.7745967，0，0.7745967，系数为0.5555556，0.8888889，0.5555556  
五点求积：高斯点-0.9061798，-0.5384693，0，0.5384693，0.9061798，系数为0.2369269，0.4786287，0.5688889，0.4786287，0.2369269  
因此对每个小区间的积分$\int_a^bf(x)dx$，作变换$y = \frac{2}{b-a}(x-a) -1$,则积分变为$\int_{-1}^1f(\frac{(y+1)(b-a)}{2}+a)(\frac{b-a}{2})dy$  
然后利用高斯求积公式，将点和系数代入即可。
## 4.复合三点高斯公式
参考3
## 5.复合五点高斯公式
参考5
## 6.复合梯形公式，复合辛普森公式，复合三点高斯公式的误差收敛阶估计
### 1) 复合梯形公式，复合辛普森公式
（定理）若插值型求积公式$\int_a^bf(x)dx$ = $\sum_{k=0}^nA_kf(x_k)$的代数精度为m，则余项可以表示为：$R[f] = \int_a^bf(x)dx - \sum_{k=0}^nA_kf(x_k) = Kf^{(m+1)}(\eta),\eta\in(a,b)$，其中K为与x无关的常数。  
（证明）略  
（延伸）令$f(x) = x^{m+1}$，代入后可得$K = \frac{1}{(m+1)!}[\frac{1}{m+2}(b^{m+2} - a^{m+2}) - \sum_{k=0}^nA_kx_k^{m+1}]$  
则易得梯形公式的余项为$R[f] = -\frac{(b - a)^3}{12}f''(\eta)$，辛普森公式余项为$R[f] = -\frac{b-a}{180}(\frac{b-a}{2})^4f^{(4)}(\eta)$  
（复合情况）以梯形公式为例，其余情况可以类比得到。  
对于复合的形式，其误差是由每个子区间的误差累加而来的，故：  
$R_n(f) = \sum_{k=0}^{n-1}[-\frac{h^3}{12}f''(\eta_k)],\eta_k\in(x_k,x_{k+1})$  
由于$f(x)\in C^2[a,b]$，故$\exists\eta\in(a,b)$，使$f''(\eta) = \frac1n\sum_{k=0}^{n-1}f''(\eta_k)$  
因此余项变为$R_n(f) = -\frac{b-a}{12}h^2f''(\eta)$  
同理，复合辛普森公式的余项为$O(h^4)$阶的。

### 2) 复合高斯求积公式
（定理）对于$x_0,x_1,...,x_n$共n+1个点。高斯求积公式$\int_a^bf(x)dx = \sum_{k=0}^nA_kf(x_k)$的余项可以表示为：  
$R[f] = \frac{f^{(2n+2)}(\eta)}{(2n+2)!}\int_a^bw_{n+1}^2(x)\rho(x)dx$  
（证明）利用$f(x)$在高斯点的埃尔米特插值$H_{2n+1}(x)$，于是$f(x) = H_{2n+1}(x) + \frac{f^{2n+2}(\xi)}{(2n+2)!}w_{n+1}^2(x)$。  
两边同乘以$\rho(x)$后，从a到b进行积分，于是$\int_a^bf(x)\rho(x)dx = \int_a^bH_{2n+1}\rho(x)dx + R_n[f]$，根据余项形式，该等式对2n+1次多项式都是精确成立的，也就是说$\int_a^bH_{2n+1}(x)\rho(x)dx$便是高斯求积公式，$R_n[f]$便是其余项。  
所以$R_n[f] = \int_a^b\frac{f^{2n+2}(\xi)}{(2n+2)!}w_{n+1}^2(x)\rho(x)dx$，由于$w_{n+1}^2(x)\rho(x)\geq0$，故由积分中值定理可知$R[f] = \frac{f^{(2n+2)}(\eta)}{(2n+2)!}\int_a^bw_{n+1}^2(x)\rho(x)dx$  
（延伸）埃尔米特插值和高斯求积公式有一定的联系：对高斯点进行埃尔米特插值，得到的插值公式再进行积分后便是高斯求积公式。  

那么当为[a, b]上的勒让德插值时，代入得$R[f] = \frac{f^{(2n+2)}(\eta)}{(2n+2)!}\int_a^bQ_{n+1}^2(x)dx,\eta\in[a,b]$，其中$Q_{n+1}(x)$是最高项系数为1的在区间[a,b]上的权函数为1的正交多项式。  
此时关键是求$\int_a^bQ_{n+1}^2(x)dx$  
本能的猜想，其应该和勒让德多项式（[-1,1]上权函数为1的正交多项式）有关系。讨论如下：  
事实上，对勒让德多项式作变换$x=(y-\frac{b-a}{2})\frac{2}{b-a}$，得到的关于y的定义在[a,b]上的多项式是一族正交多项式。因为，假设这样的对应关系为$P_n(x)\rightarrow \check{Q}_n(y)$，那么对于任意小于n的多项式$f(y)$，积分式$\int_a^b\check{Q}_n(y)f(y)dy$通过反变换$y=\frac{b-a}{2}x+\frac{b+a}{2}$可得到$\int_{-1}^{1}P_n(x)f(\frac{b-a}{2}x+\frac{b+a}{2})dx$，注意到这里$f(\frac{b-a}{2}x+\frac{b+a}{2})$，由于是线性变化，故其关于x的阶数没有发生变化，仍是小于n的，而$P_n(x)$是已知的[-1,1]上的权函数为1的正交多项式，它和任意小于n的多项式积分都为0，因此该积分为0，所以变换$x=(y-\frac{b-a}{2})\frac{2}{b-a}$可以得到[a,b]区间上的一族权函数为1的正交多项式。   
因此，对$\int_{-1}^1P_{n+1}^2(x)dx$，作变换$x=(y-\frac{b-a}{2})\frac{2}{b-a}$，得到$\frac{2}{b-a}\int_a^b\check{Q}_{n+1}^2(y)dy$，由上述讨论，这里的$\check{Q}_{n+1}(y)$是区间[a,b]上的权函数为1的正交多项式，由于我们的$Q_{n+1}(x)$也是区间[a,b]上权函数为1的正交多项式，由正交多项式的唯一性知，二者应该只差常数倍。   
然后，我们来确定倍数，因为我们的$Q_{n+1}(x)$中的指数最高的项的系数为1。下面我们确定$\check{Q}_{n+1}(x)$的系数。我们也知道，勒让德多项式有简单表达式：  
$P_0(x)=1,P_n(x)=\frac{1}{2^nn!}\frac{d^n}{dx^n}(x^2-1)^n$  
对于$P_n(x)=\frac{1}{2^nn!}\frac{d^n}{dx^n}(x^2-1)^n$，作变化$x=(y-\frac{b-a}{2})\frac{2}{b-a}$后，由链式求导法则，得到的多项式的最高的项的系数应该有$(\frac{2}{b-a})^n$，因此$k(\frac{2}{b-a})^nQ_{n+1}(x)=\check{Q}_{n+1}(x)$，其中k是一个和n有关的常数。  
于是，$\int_a^bQ_{n+1}^2(x)dx=k(\frac{b-a}{2})^{2n}\int_a^b\check{Q}_{n+1}^2(x)dx=k(\frac{b-a}{2})^{2n}\frac{b-a}{2}\int_{-1}^1P_{n+1}^2(x)dx$  
由于有：  
$\int_{-1}^1P_n(x)P_m(x)=\begin{cases} 0,m\neq n \\ \frac{2}{2n+1},m=n	\end{cases}$  
因此$\int_a^bQ_{n+1}^2(x)dx$为$O(h^{2n+1})$阶的。  
因此单个区间的误差收敛阶也为$O(h^{2n+1})$阶的。但在所有区间上的话需要减少一阶，因此复合n点高斯求积公式的误差收敛阶为$O(h^{2n})$  
### 3) 误差收敛阶的验证
进行阶数验证的时候，以区间长度一定阶数作为x轴，误差作为y轴，作图。比如复合的梯形公式，以$h^2$为x轴，误差绝对值为y轴作图，得到的是一条上升的直线，说明误差阶是$O(h^2)$阶的。  
作图时遇见了很多意料之外的情况，列举如下：  
1.按理论阶数n作图时得到的并不是一条直线，一般的，如果不是一条直线，如果是下凸或者是上凸的，仍可以证明是$O(h^n)$的，因为下凸或者上凸代表收敛阶数比n还大。这时可以调大阶数，但调大阶数又会变成凹函数，这说明不是一条直线另有原因。事实上，由于误差公式中有一些类似$f(\eta),\eta\in[a,b]$等不确定的项，会导致图像可能并不是严格意义上的直线，但当n取的足够大时，这些项带来的不确定性会减小，图像便会近似成为一条直线。  
2.按上述方法作图时得到的是一条随$h^n$增大而减小的一条直线，即随着区间数减小精度在增加！显然不符合理论。多次试验后发现，当取得足够多精度时，得到的积分值和理论积分值相差一个量级为$10^{-8}$的常数。因此随着区间数增加，积分值会偏离理论值，呈现一条下降的曲线。至于为什么相差一个常数，猜测应该是计算机的误差。因为这种情况发生在复合三点高斯求积中，在该积分式中，积分点和相关系数都是一个无理数的近似数，而且理论值也只是逼近理论值，计算精度毕竟有限，所以造成相差一个常数的情况。但只要是一条直线，就可以说是$O(h^n)$阶的。











